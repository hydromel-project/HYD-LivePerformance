<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HYD Playrate Bot - Config Panel</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-dark: #0d1117;
      --bg-card: #161b22;
      --bg-input: #21262d;
      --border: #30363d;
      --text: #c9d1d9;
      --text-dim: #8b949e;
      --accent: #00ff88;
      --accent-dim: rgba(0, 255, 136, 0.1);
      --danger: #f85149;
      --warning: #d29922;
      --info: #58a6ff;
      --purple: #a855f7;
    }

    body {
      background: var(--bg-dark);
      color: var(--text);
      font-family: 'Inter', -apple-system, sans-serif;
      line-height: 1.5;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    header h1 span {
      color: var(--accent);
    }

    .status-badges {
      display: flex;
      gap: 10px;
    }

    .badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      background: var(--bg-card);
      border: 1px solid var(--border);
    }

    .badge .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--danger);
    }

    .badge.connected .dot { background: var(--accent); }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .card h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card h2 .icon {
      font-size: 1.2rem;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-dim);
      margin-bottom: 6px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .form-group input[type="color"] {
      height: 40px;
      padding: 4px;
      cursor: pointer;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .form-row.three {
      grid-template-columns: 1fr 1fr 1fr;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--bg-input);
      border-radius: 6px;
      cursor: pointer;
    }

    .checkbox-group input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-group span {
      font-size: 14px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent);
      color: var(--bg-dark);
    }

    .btn-primary:hover {
      filter: brightness(1.1);
    }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--text-dim);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-purple {
      background: var(--purple);
      color: white;
    }

    .btn-info {
      background: var(--info);
      color: white;
    }

    .btn-block {
      width: 100%;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn-row .btn {
      flex: 1;
    }

    /* Game Control Panel */
    .game-control {
      text-align: center;
      padding: 30px;
    }

    .game-toggle {
      position: relative;
      width: 200px;
      height: 60px;
      margin: 0 auto 20px;
    }

    .game-toggle input {
      display: none;
    }

    .game-toggle label {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: 30px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .game-toggle input:checked + label {
      background: var(--accent-dim);
      border-color: var(--accent);
      color: var(--accent);
    }

    .game-status {
      font-size: 14px;
      color: var(--text-dim);
    }

    /* Playrate Display */
    .playrate-display {
      text-align: center;
      padding: 30px;
    }

    .playrate-value {
      font-size: 72px;
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }

    .playrate-slider {
      width: 100%;
      margin: 20px 0;
      -webkit-appearance: none;
      height: 8px;
      border-radius: 4px;
      background: var(--bg-input);
    }

    .playrate-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
    }

    .playrate-bounds {
      display: flex;
      justify-content: space-between;
      color: var(--text-dim);
      font-size: 12px;
    }

    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    .quick-action {
      padding: 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .quick-action.speed-up {
      background: linear-gradient(135deg, #ff4400, #ff8800);
      color: white;
    }

    .quick-action.slow-down {
      background: linear-gradient(135deg, #0088ff, #00ddff);
      color: white;
    }

    .quick-action.chaos {
      background: linear-gradient(135deg, #ff00ff, #8800ff);
      color: white;
    }

    .quick-action.reset {
      background: linear-gradient(135deg, #00ff88, #00ddaa);
      color: var(--bg-dark);
    }

    .quick-action:hover {
      transform: scale(1.05);
    }

    /* Reward Config */
    .reward-item {
      background: var(--bg-input);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
    }

    .reward-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .reward-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .reward-color {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }

    /* History */
    .history-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid var(--border);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-action {
      font-weight: 500;
    }

    .history-action.speed-up { color: #ff8800; }
    .history-action.slow-down { color: #00ddff; }
    .history-action.chaos { color: #ff00ff; }
    .history-action.reset { color: #00ff88; }

    .history-time {
      font-size: 12px;
      color: var(--text-dim);
    }

    /* Donation Thresholds */
    .threshold-item {
      display: grid;
      grid-template-columns: 100px 100px 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 10px;
      background: var(--bg-input);
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .threshold-item input {
      padding: 8px;
    }

    /* Messages */
    .message-preview {
      background: var(--bg-input);
      border-radius: 6px;
      padding: 10px;
      font-family: monospace;
      font-size: 13px;
      margin-top: 5px;
    }

    /* Section divider */
    .divider {
      border-top: 1px solid var(--border);
      margin: 20px 0;
    }

    /* Help text */
    .help-text {
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 4px;
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success { border-color: var(--accent); }
    .toast.error { border-color: var(--danger); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>HYD <span>Playrate Bot</span></h1>
      <div class="status-badges">
        <div class="badge" id="reaperStatus">
          <span class="dot"></span>
          <span>REAPER</span>
        </div>
        <div class="badge" id="twitchStatus">
          <span class="dot"></span>
          <span>Twitch</span>
        </div>
        <div class="badge" id="streamlabsStatus">
          <span class="dot"></span>
          <span>Streamlabs</span>
        </div>
        <div class="badge" id="streamelementsStatus">
          <span class="dot"></span>
          <span>StreamElements</span>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- Game Control -->
      <div class="card">
        <h2><span class="icon">üéÆ</span> Game Mode</h2>
        <div class="game-control">
          <div class="game-toggle">
            <input type="checkbox" id="gameEnabled">
            <label for="gameEnabled">
              <span id="gameToggleText">ACTIVATE</span>
            </label>
          </div>
          <p class="game-status" id="gameStatus">
            Enable to create channel point rewards and start accepting viewer interactions.
          </p>
        </div>

        <div class="divider"></div>

        <div class="playrate-display">
          <div class="playrate-value" id="currentPlayrate">1.00x</div>
          <input type="range" class="playrate-slider" id="playrateSlider" min="0.5" max="2.5" step="0.05" value="1">
          <div class="playrate-bounds">
            <span id="minBound">0.5x</span>
            <span id="maxBound">2.5x</span>
          </div>
        </div>

        <div class="quick-actions">
          <button class="quick-action slow-down" onclick="triggerAction('slowDown')">üßä SLOW</button>
          <button class="quick-action speed-up" onclick="triggerAction('speedUp')">üî• FAST</button>
          <button class="quick-action chaos" onclick="triggerAction('chaos')">üé≤ CHAOS</button>
          <button class="quick-action reset" onclick="triggerAction('reset')">‚ú® RESET</button>
        </div>
      </div>

      <!-- Twitch Setup -->
      <div class="card">
        <h2><span class="icon">üü£</span> Twitch Setup</h2>

        <div class="form-group">
          <label>Client ID</label>
          <input type="text" id="twitchClientId" placeholder="From Twitch Developer Console">
          <p class="help-text">Get this from <a href="https://dev.twitch.tv/console" target="_blank" style="color:var(--info)">dev.twitch.tv/console</a></p>
        </div>

        <div class="form-group">
          <label>Client Secret</label>
          <input type="password" id="twitchClientSecret" placeholder="Keep this secret!">
        </div>

        <div class="form-group">
          <label>Channel Name</label>
          <input type="text" id="twitchChannel" placeholder="Your Twitch username">
        </div>

        <div class="btn-row">
          <button class="btn btn-purple" id="twitchAuthBtn" onclick="startTwitchAuth()">
            Connect to Twitch
          </button>
          <button class="btn btn-secondary" onclick="saveTwitchConfig()">
            Save
          </button>
        </div>
      </div>

      <!-- Streamlabs Setup -->
      <div class="card">
        <h2><span class="icon">üíú</span> Streamlabs Setup</h2>

        <div class="form-group">
          <label>Socket API Token</label>
          <input type="password" id="streamlabsToken" placeholder="From Streamlabs Dashboard">
          <p class="help-text">
            Find this in Streamlabs Dashboard ‚Üí Settings ‚Üí API Settings ‚Üí API Tokens ‚Üí Socket API Token
          </p>
        </div>

        <div class="btn-row">
          <button class="btn btn-secondary" onclick="saveStreamlabsConfig()">
            Save & Connect
          </button>
        </div>

      </div>

      <!-- StreamElements Setup -->
      <div class="card">
        <h2><span class="icon">üü¢</span> StreamElements Setup</h2>

        <div class="form-group">
          <label>JWT Token</label>
          <input type="password" id="streamelementsToken" placeholder="From StreamElements Dashboard">
          <p class="help-text">
            Find this in StreamElements Dashboard ‚Üí Account Settings ‚Üí Channels ‚Üí Show secrets ‚Üí JWT Token
          </p>
        </div>

        <div class="btn-row">
          <button class="btn btn-secondary" onclick="saveStreamElementsConfig()">
            Save & Connect
          </button>
        </div>
      </div>

      <!-- Donation Actions -->
      <div class="card">
        <h2><span class="icon">üí∞</span> Donation Actions</h2>
        <p class="help-text" style="margin-bottom:15px;">
          Configure what happens when viewers donate via Streamlabs or StreamElements.
        </p>
        <div id="donationThresholds"></div>
        <button class="btn btn-secondary btn-block" onclick="addDonationThreshold()">
          + Add Threshold
        </button>
      </div>

      <!-- REAPER OSC Setup -->
      <div class="card">
        <h2><span class="icon">üì°</span> REAPER OSC</h2>

        <div class="form-row">
          <div class="form-group">
            <label>Send Port (REAPER listens)</label>
            <input type="number" id="reaperSendPort" value="8000">
          </div>
          <div class="form-group">
            <label>Receive Port (Bot listens)</label>
            <input type="number" id="reaperReceivePort" value="9000">
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-secondary" onclick="saveReaperConfig()">
            Save
          </button>
        </div>

        <div class="divider"></div>

        <h3 style="font-size:14px;margin-bottom:10px;">REAPER Setup Instructions</h3>
        <ol style="font-size:13px;color:var(--text-dim);padding-left:20px;">
          <li>Open REAPER Preferences (Ctrl+P)</li>
          <li>Go to Control/OSC/Web</li>
          <li>Click Add ‚Üí OSC (Open Sound Control)</li>
          <li>Set Mode: Configure device IP+local port</li>
          <li>Device IP: 127.0.0.1</li>
          <li>Device port: <span id="oscDevicePort">9000</span></li>
          <li>Local listen port: <span id="oscLocalPort">8000</span></li>
          <li>Enable "Allow binding messages..."</li>
        </ol>
      </div>

      <!-- Channel Point Rewards -->
      <div class="card">
        <h2><span class="icon">üéÅ</span> Channel Point Rewards</h2>

        <!-- Dynamic Pricing Display -->
        <div style="background:linear-gradient(135deg, #1a1a2e, #16213e);border-radius:8px;padding:15px;margin-bottom:15px;border:1px solid var(--border);">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
            <span style="font-weight:600;">üìä Live Prices</span>
            <label class="checkbox-group" style="padding:5px 10px;margin:0;">
              <input type="checkbox" id="dynamicPricingEnabled" checked>
              <span style="font-size:12px;">Dynamic</span>
            </label>
          </div>
          <div id="livePricesDisplay" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center;">
            <div style="background:rgba(255,68,0,0.2);padding:8px;border-radius:6px;">
              <div style="font-size:10px;color:var(--text-dim);">üî• Speed</div>
              <div id="liveSpeedUpCost" style="font-weight:700;color:#ff4400;">500</div>
            </div>
            <div style="background:rgba(0,170,255,0.2);padding:8px;border-radius:6px;">
              <div style="font-size:10px;color:var(--text-dim);">üßä Slow</div>
              <div id="liveSlowDownCost" style="font-weight:700;color:#00aaff;">500</div>
            </div>
            <div style="background:rgba(255,0,255,0.2);padding:8px;border-radius:6px;">
              <div style="font-size:10px;color:var(--text-dim);">üé≤ Chaos</div>
              <div id="liveChaosCost" style="font-weight:700;color:#ff00ff;">2500</div>
            </div>
            <div style="background:rgba(0,255,136,0.2);padding:8px;border-radius:6px;">
              <div style="font-size:10px;color:var(--text-dim);">‚ú® Reset</div>
              <div id="liveResetCost" style="font-weight:700;color:#00ff88;">1500</div>
            </div>
          </div>
          <p style="font-size:11px;color:var(--text-dim);margin-top:10px;text-align:center;">
            Prices adjust based on current playrate ‚Ä¢ Extremes = higher costs
          </p>
        </div>

        <!-- Quick Base Price Adjustment -->
        <div style="background:var(--bg-input);border-radius:8px;padding:15px;margin-bottom:15px;">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
            <span style="font-weight:600;">‚ö° Set All Base Prices</span>
          </div>
          <div style="display:flex;gap:10px;align-items:center;">
            <input type="number" id="quickPriceValue" value="1000" min="1" style="width:120px;padding:8px;background:var(--bg-dark);border:1px solid var(--border);border-radius:6px;color:var(--text);">
            <button class="btn btn-secondary" onclick="setAllPrices()">Apply</button>
            <span style="color:var(--text-dim);font-size:12px;">Sets all base costs</span>
          </div>
        </div>

        <div class="reward-item">
          <div class="reward-header">
            <span class="reward-title">
              <span class="reward-color" style="background:#FF4400"></span>
              üî• Speed Up
            </span>
            <label class="checkbox-group" style="padding:5px 10px;">
              <input type="checkbox" id="rewardSpeedUpEnabled" checked>
              <span>Enabled</span>
            </label>
          </div>
          <div class="form-row three">
            <div class="form-group">
              <label>Base Cost</label>
              <input type="number" id="rewardSpeedUpCost" value="500">
            </div>
            <div class="form-group">
              <label>Increment</label>
              <input type="number" id="rewardSpeedUpIncrement" value="0.1" step="0.05">
            </div>
            <div class="form-group">
              <label>Cooldown (s)</label>
              <input type="number" id="rewardSpeedUpCooldown" value="0">
            </div>
          </div>
        </div>

        <div class="reward-item">
          <div class="reward-header">
            <span class="reward-title">
              <span class="reward-color" style="background:#00AAFF"></span>
              üßä Slow Down
            </span>
            <label class="checkbox-group" style="padding:5px 10px;">
              <input type="checkbox" id="rewardSlowDownEnabled" checked>
              <span>Enabled</span>
            </label>
          </div>
          <div class="form-row three">
            <div class="form-group">
              <label>Base Cost</label>
              <input type="number" id="rewardSlowDownCost" value="500">
            </div>
            <div class="form-group">
              <label>Increment</label>
              <input type="number" id="rewardSlowDownIncrement" value="0.1" step="0.05">
            </div>
            <div class="form-group">
              <label>Cooldown (s)</label>
              <input type="number" id="rewardSlowDownCooldown" value="0">
            </div>
          </div>
        </div>

        <div class="reward-item">
          <div class="reward-header">
            <span class="reward-title">
              <span class="reward-color" style="background:#FF00FF"></span>
              üé≤ Chaos
            </span>
            <label class="checkbox-group" style="padding:5px 10px;">
              <input type="checkbox" id="rewardChaosEnabled" checked>
              <span>Enabled</span>
            </label>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Base Cost</label>
              <input type="number" id="rewardChaosCost" value="2500">
            </div>
            <div class="form-group">
              <label>Cooldown (s)</label>
              <input type="number" id="rewardChaosCooldown" value="30">
            </div>
          </div>
        </div>

        <div class="reward-item">
          <div class="reward-header">
            <span class="reward-title">
              <span class="reward-color" style="background:#00FF88"></span>
              ‚ú® Reset
            </span>
            <label class="checkbox-group" style="padding:5px 10px;">
              <input type="checkbox" id="rewardResetEnabled" checked>
              <span>Enabled</span>
            </label>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Base Cost</label>
              <input type="number" id="rewardResetCost" value="1500">
            </div>
            <div class="form-group">
              <label>Cooldown (s)</label>
              <input type="number" id="rewardResetCooldown" value="60">
            </div>
          </div>
        </div>

        <!-- Dynamic Pricing Settings -->
        <div class="divider"></div>
        <h3 style="font-size:14px;margin-bottom:10px;">Dynamic Pricing Settings</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Scale Factor</label>
            <input type="number" id="pricingScaleFactor" value="1.5" step="0.1" min="0.5" max="5">
            <p class="help-text">Higher = more aggressive price scaling</p>
          </div>
          <div class="form-group">
            <label>Max Cost Cap</label>
            <input type="number" id="pricingMaxCost" value="50000" step="1000">
          </div>
        </div>
        <label class="checkbox-group" style="margin-bottom:10px;">
          <input type="checkbox" id="pricingResetDiscount" checked>
          <span>Reset gets cheaper at extremes (mercy rule)</span>
        </label>

        <button class="btn btn-primary btn-block" onclick="saveRewardsConfig()">
          Save Reward Settings
        </button>
      </div>

      <!-- Game Settings -->
      <div class="card">
        <h2><span class="icon">‚öôÔ∏è</span> Game Settings</h2>

        <div class="form-row">
          <div class="form-group">
            <label>Min Playrate</label>
            <input type="number" id="gameMinPlayrate" value="0.5" step="0.1">
          </div>
          <div class="form-group">
            <label>Max Playrate</label>
            <input type="number" id="gameMaxPlayrate" value="2.5" step="0.1">
          </div>
        </div>

        <div class="divider"></div>

        <h3 style="font-size:14px;margin-bottom:10px;">Proportional Scaling</h3>
        <p style="font-size:12px;color:var(--text-dim);margin-bottom:10px;">
          Keeps the BPM change consistent regardless of tempo. A +0.1x at 120 BPM feels the same as at 210 BPM.
        </p>
        <label class="checkbox-group" style="margin-bottom:10px;">
          <input type="checkbox" id="proportionalScalingEnabled" checked>
          <span>Enable proportional scaling</span>
        </label>
        <div class="form-group">
          <label>Reference BPM (increment is as-configured at this BPM)</label>
          <input type="number" id="proportionalReferenceBpm" value="120">
        </div>
        <div style="background:var(--bg-input);border-radius:6px;padding:12px;margin-bottom:10px;">
          <div style="font-size:12px;color:var(--text-dim);margin-bottom:8px;">Current scaling:</div>
          <div style="display:flex;justify-content:space-between;font-size:13px;">
            <span>BPM: <strong id="currentBpmDisplay">120</strong></span>
            <span>Actual increment: <strong id="scaledIncrementDisplay">0.100x</strong></span>
          </div>
        </div>

        <div class="divider"></div>

        <h3 style="font-size:14px;margin-bottom:10px;">Global Cooldown</h3>
        <label class="checkbox-group" style="margin-bottom:10px;">
          <input type="checkbox" id="globalCooldownEnabled" checked>
          <span>Enable cooldown between all actions</span>
        </label>
        <div class="form-group">
          <label>Cooldown (seconds)</label>
          <input type="number" id="globalCooldownSeconds" value="5">
        </div>

        <div class="divider"></div>

        <h3 style="font-size:14px;margin-bottom:10px;">Auto Reset</h3>
        <label class="checkbox-group" style="margin-bottom:10px;">
          <input type="checkbox" id="autoResetEnabled">
          <span>Reset playrate after inactivity</span>
        </label>
        <div class="form-row">
          <div class="form-group">
            <label>Delay (seconds)</label>
            <input type="number" id="autoResetDelay" value="60">
          </div>
          <div class="form-group">
            <label>Reset to</label>
            <input type="number" id="autoResetValue" value="1.0" step="0.1">
          </div>
        </div>

        <button class="btn btn-primary btn-block" onclick="saveGameSettings()">
          Save Game Settings
        </button>
      </div>

      <!-- Test Panel -->
      <div class="card">
        <h2><span class="icon">üß™</span> Test Effects</h2>
        <p style="font-size:12px;color:var(--text-dim);margin-bottom:15px;">
          Test how effects appear in the GameHUD overlay. Make sure GameHUD is open and connected.
        </p>

        <h3 style="font-size:13px;margin-bottom:10px;color:var(--text);">Simulate Actions</h3>
        <div class="test-actions" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;">
          <button class="quick-action speed-up" onclick="testEffect('speedUp')">üî• Speed Up</button>
          <button class="quick-action slow-down" onclick="testEffect('slowDown')">üßä Slow Down</button>
          <button class="quick-action chaos" onclick="testEffect('chaos')">üé≤ Chaos</button>
          <button class="quick-action reset" onclick="testEffect('reset')">‚ú® Reset</button>
        </div>

        <div class="divider"></div>

        <h3 style="font-size:13px;margin-bottom:10px;color:var(--text);">Test Countdown</h3>
        <p style="font-size:12px;color:var(--text-dim);margin-bottom:10px;">
          Simulate the auto-reset countdown timer.
        </p>
        <div class="form-row" style="margin-bottom:10px;">
          <div class="form-group" style="margin-bottom:0;">
            <label>Countdown seconds</label>
            <input type="number" id="testCountdownSeconds" value="15" min="5" max="120">
          </div>
          <div style="display:flex;align-items:flex-end;">
            <button class="btn btn-primary" onclick="testCountdown()">Start Countdown</button>
          </div>
        </div>
        <button class="btn btn-secondary btn-block" onclick="cancelTestCountdown()">Cancel Countdown</button>

        <div class="divider"></div>

        <h3 style="font-size:13px;margin-bottom:10px;color:var(--text);">Test Individual Effects</h3>
        <div style="display:flex;flex-wrap:wrap;gap:8px;">
          <button class="btn btn-secondary" onclick="testVisualEffect('shake')">Screen Shake</button>
          <button class="btn btn-secondary" onclick="testVisualEffect('flash')">Flash</button>
          <button class="btn btn-secondary" onclick="testVisualEffect('fireParticles')">Fire Particles</button>
          <button class="btn btn-secondary" onclick="testVisualEffect('iceParticles')">Ice Particles</button>
          <button class="btn btn-secondary" onclick="testVisualEffect('ambientFire')">Ambient Fire</button>
          <button class="btn btn-secondary" onclick="testVisualEffect('stopAmbient')">Stop Ambient</button>
        </div>
      </div>

      <!-- Documentation Export -->
      <div class="card">
        <h2><span class="icon">üìÑ</span> Documentation</h2>
        <p style="font-size:13px;color:var(--text-dim);margin-bottom:15px;">
          Generate markdown documentation for your stream, mods, or viewers.
        </p>
        <div class="btn-row">
          <button class="btn btn-secondary" onclick="generateModDocs()">
            üìã Mod Commands
          </button>
          <button class="btn btn-secondary" onclick="generateViewerDocs()">
            üë• Viewer Guide
          </button>
          <button class="btn btn-primary" onclick="generateFullDocs()">
            üìö Full Documentation
          </button>
        </div>
        <div id="docsOutput" style="display:none;margin-top:15px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <span style="font-weight:600;">Generated Documentation</span>
            <button class="btn btn-secondary" onclick="copyDocs()" style="padding:5px 10px;font-size:12px;">
              üìã Copy
            </button>
          </div>
          <textarea id="docsTextarea" style="width:100%;height:300px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:monospace;font-size:12px;padding:10px;resize:vertical;"></textarea>
        </div>
      </div>

      <!-- History -->
      <div class="card">
        <h2><span class="icon">üìú</span> Recent Activity</h2>
        <div class="history-list" id="historyList">
          <p style="color:var(--text-dim);text-align:center;padding:20px;">
            No activity yet. Enable game mode and wait for viewers!
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    let ws;
    let config = {};
    let currentBpm = 120;

    // Connect to WebSocket
    function connectWS() {
      ws = new WebSocket(`ws://${window.location.host}`);

      ws.onopen = () => {
        console.log('WebSocket connected');
      };

      ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        handleMessage(msg);
      };

      ws.onclose = () => {
        console.log('WebSocket disconnected, reconnecting...');
        setTimeout(connectWS, 2000);
      };
    }

    function handleMessage(msg) {
      switch (msg.type) {
        case 'init':
          config = msg.data.config;
          updateUI();
          updateState(msg.data.state);
          break;

        case 'state':
        case 'playrateChanged':
          if (msg.data.rate !== undefined) {
            document.getElementById('currentPlayrate').textContent = msg.data.rate.toFixed(2) + 'x';
            document.getElementById('playrateSlider').value = msg.data.rate;
          }
          if (msg.data.game) {
            updateState(msg.data);
          }
          break;

        case 'actionProcessed':
          addHistoryItem(msg.data);
          showToast(`${msg.data.username}: ${msg.data.action}`, 'success');
          break;

        case 'gameToggled':
          document.getElementById('gameEnabled').checked = msg.data.enabled;
          updateGameToggle(msg.data.enabled);
          break;

        case 'configUpdated':
          config = msg.data;
          updateUI();
          break;

        case 'bpmChanged':
          if (msg.data.bpm) {
            currentBpm = msg.data.bpm;
            updateScaledIncrementDisplay();
          }
          break;

        case 'pricesUpdated':
          updateLivePrices(msg.data);
          break;
      }
    }

    function updateLivePrices(prices) {
      if (prices.speedUp) document.getElementById('liveSpeedUpCost').textContent = prices.speedUp;
      if (prices.slowDown) document.getElementById('liveSlowDownCost').textContent = prices.slowDown;
      if (prices.chaos) document.getElementById('liveChaosCost').textContent = prices.chaos;
      if (prices.reset) document.getElementById('liveResetCost').textContent = prices.reset;
    }

    function updateUI() {
      // Twitch
      document.getElementById('twitchClientId').value = config.twitch?.clientId || '';
      document.getElementById('twitchClientSecret').value = config.twitch?.clientSecret || '';
      document.getElementById('twitchChannel').value = config.twitch?.broadcasterName || '';

      // Streamlabs
      document.getElementById('streamlabsToken').value = config.streamlabs?.socketToken || '';

      // StreamElements
      document.getElementById('streamelementsToken').value = config.streamelements?.jwtToken || '';

      // REAPER
      document.getElementById('reaperSendPort').value = config.reaper?.sendPort || 8000;
      document.getElementById('reaperReceivePort').value = config.reaper?.receivePort || 9000;
      document.getElementById('oscDevicePort').textContent = config.reaper?.receivePort || 9000;
      document.getElementById('oscLocalPort').textContent = config.reaper?.sendPort || 8000;

      // Game settings
      document.getElementById('gameEnabled').checked = config.game?.enabled || false;
      document.getElementById('gameMinPlayrate').value = config.game?.minPlayrate || 0.5;
      document.getElementById('gameMaxPlayrate').value = config.game?.maxPlayrate || 2.5;
      document.getElementById('minBound').textContent = (config.game?.minPlayrate || 0.5) + 'x';
      document.getElementById('maxBound').textContent = (config.game?.maxPlayrate || 2.5) + 'x';

      document.getElementById('globalCooldownEnabled').checked = config.game?.globalCooldown?.enabled ?? true;
      document.getElementById('globalCooldownSeconds').value = config.game?.globalCooldown?.seconds || 5;
      document.getElementById('autoResetEnabled').checked = config.game?.autoReset?.enabled || false;
      document.getElementById('autoResetDelay').value = config.game?.autoReset?.delaySeconds || 60;
      document.getElementById('autoResetValue').value = config.game?.autoReset?.resetTo || 1.0;

      // Proportional scaling
      document.getElementById('proportionalScalingEnabled').checked = config.game?.proportionalScaling?.enabled ?? true;
      document.getElementById('proportionalReferenceBpm').value = config.game?.proportionalScaling?.referenceBpm || 120;
      updateScaledIncrementDisplay();

      // Rewards
      const rewards = config.rewards || {};
      document.getElementById('rewardSpeedUpEnabled').checked = rewards.speedUp?.enabled ?? true;
      document.getElementById('rewardSpeedUpCost').value = rewards.speedUp?.baseCost || 500;
      document.getElementById('rewardSpeedUpIncrement').value = rewards.speedUp?.increment || 0.1;
      document.getElementById('rewardSpeedUpCooldown').value = rewards.speedUp?.cooldownSeconds || 0;

      document.getElementById('rewardSlowDownEnabled').checked = rewards.slowDown?.enabled ?? true;
      document.getElementById('rewardSlowDownCost').value = rewards.slowDown?.baseCost || 500;
      document.getElementById('rewardSlowDownIncrement').value = rewards.slowDown?.increment || 0.1;
      document.getElementById('rewardSlowDownCooldown').value = rewards.slowDown?.cooldownSeconds || 0;

      document.getElementById('rewardChaosEnabled').checked = rewards.chaos?.enabled ?? true;
      document.getElementById('rewardChaosCost').value = rewards.chaos?.baseCost || 2500;
      document.getElementById('rewardChaosCooldown').value = rewards.chaos?.cooldownSeconds || 30;

      document.getElementById('rewardResetEnabled').checked = rewards.reset?.enabled ?? true;
      document.getElementById('rewardResetCost').value = rewards.reset?.baseCost || 1500;
      document.getElementById('rewardResetCooldown').value = rewards.reset?.cooldownSeconds || 60;

      // Dynamic pricing settings
      const pricing = rewards.dynamicPricing || {};
      document.getElementById('dynamicPricingEnabled').checked = pricing.enabled ?? true;
      document.getElementById('pricingScaleFactor').value = pricing.scaleFactor || 1.5;
      document.getElementById('pricingMaxCost').value = pricing.maxCost || 50000;
      document.getElementById('pricingResetDiscount').checked = pricing.resetDiscountAtExtremes ?? true;

      // Update live prices display
      updateLivePrices({
        speedUp: rewards.speedUp?.cost || rewards.speedUp?.baseCost || 500,
        slowDown: rewards.slowDown?.cost || rewards.slowDown?.baseCost || 500,
        chaos: rewards.chaos?.cost || rewards.chaos?.baseCost || 2500,
        reset: rewards.reset?.cost || rewards.reset?.baseCost || 1500
      });

      // Slider bounds
      const slider = document.getElementById('playrateSlider');
      slider.min = config.game?.minPlayrate || 0.5;
      slider.max = config.game?.maxPlayrate || 2.5;

      updateGameToggle(config.game?.enabled || false);
    }

    function updateState(state) {
      // Update status badges
      document.getElementById('reaperStatus').classList.toggle('connected', state.reaper?.connected);
      document.getElementById('twitchStatus').classList.toggle('connected', state.twitch?.connected);
      document.getElementById('streamlabsStatus').classList.toggle('connected', state.streamlabs?.connected);
      document.getElementById('streamelementsStatus').classList.toggle('connected', state.streamelements?.connected);

      // Update BPM from game state
      if (state.game?.currentBpm) {
        currentBpm = state.game.currentBpm;
        updateScaledIncrementDisplay();
      }
    }

    function updateGameToggle(enabled) {
      const text = document.getElementById('gameToggleText');
      const status = document.getElementById('gameStatus');

      if (enabled) {
        text.textContent = 'ACTIVE';
        status.textContent = 'Game mode is ON. Viewers can now mess with your playrate!';
      } else {
        text.textContent = 'ACTIVATE';
        status.textContent = 'Enable to create channel point rewards and start accepting viewer interactions.';
      }
    }

    function updateScaledIncrementDisplay() {
      const enabled = document.getElementById('proportionalScalingEnabled')?.checked ?? true;
      const referenceBpm = parseInt(document.getElementById('proportionalReferenceBpm')?.value) || 120;
      const baseIncrement = parseFloat(document.getElementById('rewardSpeedUpIncrement')?.value) || 0.1;

      document.getElementById('currentBpmDisplay').textContent = currentBpm;

      if (enabled && referenceBpm > 0 && currentBpm > 0) {
        const scaledIncrement = baseIncrement * (referenceBpm / currentBpm);
        document.getElementById('scaledIncrementDisplay').textContent = scaledIncrement.toFixed(3) + 'x';
      } else {
        document.getElementById('scaledIncrementDisplay').textContent = baseIncrement.toFixed(3) + 'x';
      }
    }

    // Event handlers
    document.getElementById('gameEnabled').addEventListener('change', async (e) => {
      const enabled = e.target.checked;
      const response = await fetch('/api/game/toggle', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ enabled })
      });
      const result = await response.json();
      if (result.success) {
        showToast(enabled ? 'Game mode activated!' : 'Game mode deactivated', 'success');
      }
    });

    document.getElementById('playrateSlider').addEventListener('input', (e) => {
      const rate = parseFloat(e.target.value);
      document.getElementById('currentPlayrate').textContent = rate.toFixed(2) + 'x';
    });

    document.getElementById('playrateSlider').addEventListener('change', async (e) => {
      const rate = parseFloat(e.target.value);
      await fetch('/api/playrate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rate })
      });
    });

    // Update scaled increment display when settings change
    document.getElementById('proportionalScalingEnabled').addEventListener('change', updateScaledIncrementDisplay);
    document.getElementById('proportionalReferenceBpm').addEventListener('input', updateScaledIncrementDisplay);
    document.getElementById('rewardSpeedUpIncrement').addEventListener('input', updateScaledIncrementDisplay);

    async function triggerAction(action) {
      const response = await fetch('/api/action', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, username: 'Manual' })
      });
      const result = await response.json();
      if (result.success) {
        document.getElementById('currentPlayrate').textContent = result.newRate.toFixed(2) + 'x';
        document.getElementById('playrateSlider').value = result.newRate;
      }
    }

    async function startTwitchAuth() {
      await saveTwitchConfig();
      const response = await fetch('/api/twitch/auth-url');
      const { url } = await response.json();
      window.open(url, '_blank', 'width=500,height=700');
    }

    async function saveTwitchConfig() {
      const data = {
        twitch: {
          clientId: document.getElementById('twitchClientId').value,
          clientSecret: document.getElementById('twitchClientSecret').value,
          broadcasterName: document.getElementById('twitchChannel').value,
          botName: document.getElementById('twitchChannel').value
        }
      };
      await updateConfig(data);
      showToast('Twitch config saved', 'success');
    }

    async function saveStreamlabsConfig() {
      const data = {
        streamlabs: {
          socketToken: document.getElementById('streamlabsToken').value
        }
      };
      await updateConfig(data);
      showToast('Streamlabs config saved. Restart the bot to connect.', 'success');
    }

    async function saveStreamElementsConfig() {
      const data = {
        streamelements: {
          jwtToken: document.getElementById('streamelementsToken').value
        }
      };
      await updateConfig(data);
      showToast('StreamElements config saved. Restart the bot to connect.', 'success');
    }

    async function saveReaperConfig() {
      const data = {
        reaper: {
          sendPort: parseInt(document.getElementById('reaperSendPort').value),
          receivePort: parseInt(document.getElementById('reaperReceivePort').value)
        }
      };
      await updateConfig(data);
      document.getElementById('oscDevicePort').textContent = data.reaper.receivePort;
      document.getElementById('oscLocalPort').textContent = data.reaper.sendPort;
      showToast('REAPER config saved. Restart the bot to apply.', 'success');
    }

    function setAllPrices() {
      const price = parseInt(document.getElementById('quickPriceValue').value) || 1000;
      document.getElementById('rewardSpeedUpCost').value = price;
      document.getElementById('rewardSlowDownCost').value = price;
      document.getElementById('rewardChaosCost').value = price;
      document.getElementById('rewardResetCost').value = price;
      showToast(`All rewards set to ${price} points`, 'success');
    }

    async function saveRewardsConfig() {
      const baseCostSpeedUp = parseInt(document.getElementById('rewardSpeedUpCost').value);
      const baseCostSlowDown = parseInt(document.getElementById('rewardSlowDownCost').value);
      const baseCostChaos = parseInt(document.getElementById('rewardChaosCost').value);
      const baseCostReset = parseInt(document.getElementById('rewardResetCost').value);

      const data = {
        rewards: {
          speedUp: {
            enabled: document.getElementById('rewardSpeedUpEnabled').checked,
            baseCost: baseCostSpeedUp,
            cost: baseCostSpeedUp,  // Initialize cost to baseCost
            increment: parseFloat(document.getElementById('rewardSpeedUpIncrement').value),
            cooldownSeconds: parseInt(document.getElementById('rewardSpeedUpCooldown').value)
          },
          slowDown: {
            enabled: document.getElementById('rewardSlowDownEnabled').checked,
            baseCost: baseCostSlowDown,
            cost: baseCostSlowDown,
            increment: parseFloat(document.getElementById('rewardSlowDownIncrement').value),
            cooldownSeconds: parseInt(document.getElementById('rewardSlowDownCooldown').value)
          },
          chaos: {
            enabled: document.getElementById('rewardChaosEnabled').checked,
            baseCost: baseCostChaos,
            cost: baseCostChaos,
            cooldownSeconds: parseInt(document.getElementById('rewardChaosCooldown').value)
          },
          reset: {
            enabled: document.getElementById('rewardResetEnabled').checked,
            baseCost: baseCostReset,
            cost: baseCostReset,
            cooldownSeconds: parseInt(document.getElementById('rewardResetCooldown').value)
          },
          dynamicPricing: {
            enabled: document.getElementById('dynamicPricingEnabled').checked,
            scaleFactor: parseFloat(document.getElementById('pricingScaleFactor').value),
            minCost: 100,
            maxCost: parseInt(document.getElementById('pricingMaxCost').value),
            resetDiscountAtExtremes: document.getElementById('pricingResetDiscount').checked
          }
        }
      };
      await updateConfig(data);
      showToast('Reward settings saved', 'success');
    }

    async function saveGameSettings() {
      const data = {
        game: {
          minPlayrate: parseFloat(document.getElementById('gameMinPlayrate').value),
          maxPlayrate: parseFloat(document.getElementById('gameMaxPlayrate').value),
          proportionalScaling: {
            enabled: document.getElementById('proportionalScalingEnabled').checked,
            referenceBpm: parseInt(document.getElementById('proportionalReferenceBpm').value)
          },
          globalCooldown: {
            enabled: document.getElementById('globalCooldownEnabled').checked,
            seconds: parseInt(document.getElementById('globalCooldownSeconds').value)
          },
          autoReset: {
            enabled: document.getElementById('autoResetEnabled').checked,
            delaySeconds: parseInt(document.getElementById('autoResetDelay').value),
            resetTo: parseFloat(document.getElementById('autoResetValue').value)
          }
        }
      };
      await updateConfig(data);

      // Update slider bounds
      const slider = document.getElementById('playrateSlider');
      slider.min = data.game.minPlayrate;
      slider.max = data.game.maxPlayrate;
      document.getElementById('minBound').textContent = data.game.minPlayrate + 'x';
      document.getElementById('maxBound').textContent = data.game.maxPlayrate + 'x';

      showToast('Game settings saved', 'success');
    }

    async function updateConfig(data) {
      await fetch('/api/config', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
    }

    function addHistoryItem(data) {
      const list = document.getElementById('historyList');

      // Remove empty message
      if (list.querySelector('p')) {
        list.innerHTML = '';
      }

      const item = document.createElement('div');
      item.className = 'history-item';
      item.innerHTML = `
        <div>
          <span class="history-action ${data.action}">${data.action}</span>
          <span style="color:var(--text-dim);margin-left:8px;">by ${data.username}</span>
        </div>
        <div>
          <span style="font-weight:600;">${data.newRate?.toFixed(2) || '-'}x</span>
          <span class="history-time">${new Date().toLocaleTimeString()}</span>
        </div>
      `;

      list.insertBefore(item, list.firstChild);

      // Keep only last 20 items
      while (list.children.length > 20) {
        list.removeChild(list.lastChild);
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // ============ TEST FUNCTIONS ============

    async function testEffect(action) {
      // Send test action via WebSocket - this will be broadcast to GameHUD
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
          type: 'testAction',
          action: action,
          username: 'TEST_USER'
        }));
        showToast(`Testing ${action} effect`, 'success');
      } else {
        showToast('WebSocket not connected', 'error');
      }
    }

    function testCountdown() {
      const seconds = parseInt(document.getElementById('testCountdownSeconds').value) || 15;
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
          type: 'testCountdown',
          seconds: seconds
        }));
        showToast(`Starting ${seconds}s countdown test`, 'success');
      } else {
        showToast('WebSocket not connected', 'error');
      }
    }

    function cancelTestCountdown() {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
          type: 'testCancelCountdown'
        }));
        showToast('Countdown cancelled', 'success');
      }
    }

    function testVisualEffect(effect) {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
          type: 'testVisualEffect',
          effect: effect
        }));
        showToast(`Testing ${effect}`, 'success');
      } else {
        showToast('WebSocket not connected', 'error');
      }
    }

    // ============ DOCUMENTATION GENERATORS ============

    function generateModDocs() {
      const rewards = config.rewards || {};
      const game = config.game || {};
      const dynamicPricing = rewards.dynamicPricing?.enabled ? 'Yes' : 'No';

      const doc = `# üéõÔ∏è Mod Commands - HYD Playrate Bot

## Chat Commands (Mod/Broadcaster Only)

| Command | Description |
|---------|-------------|
| \`!playrate <0.5-4.0>\` | Set playrate to exact value |
| \`!testreaper\` | Check if REAPER OSC is connected |
| \`!reapercommands\` | Show list of mod commands |

## Current Settings

- **Playrate Range:** ${game.minPlayrate || 0.5}x - ${game.maxPlayrate || 4.0}x
- **Dynamic Pricing:** ${dynamicPricing}
- **Global Cooldown:** ${game.globalCooldown?.seconds || 5}s

## Channel Point Rewards

| Reward | Base Cost | Description |
|--------|-----------|-------------|
| üî• Speed Up | ${rewards.speedUp?.baseCost || 500} pts | +${rewards.speedUp?.increment || 0.1}x playrate |
| üßä Slow Down | ${rewards.slowDown?.baseCost || 500} pts | -${rewards.slowDown?.increment || 0.1}x playrate |
| üé≤ CHAOS | ${rewards.chaos?.baseCost || 2500} pts | Random playrate (${game.minPlayrate || 0.5}x - ${game.maxPlayrate || 4.0}x) |
| ‚ú® Reset | ${rewards.reset?.baseCost || 1500} pts | Reset to 1.0x |

${rewards.dynamicPricing?.enabled ? `
## Dynamic Pricing

Prices adjust based on current playrate:
- **Speed Up**: More expensive at high speeds
- **Slow Down**: More expensive at low speeds
- **Chaos**: Always expensive, more at extremes
- **Reset**: Gets cheaper at extremes (mercy rule)

Scale Factor: ${rewards.dynamicPricing?.scaleFactor || 1.5}x
` : ''}

---
*Generated by HYD Playrate Bot*
`;

      showDocs(doc);
    }

    function generateViewerDocs() {
      const rewards = config.rewards || {};
      const game = config.game || {};
      const requests = config.requests || {};

      const doc = `# üéÆ Viewer Guide - Playrate Chaos

## How It Works

Use your channel points to mess with the streamer's playback speed!
The song will speed up or slow down based on chat's choices.

## Channel Point Rewards

| Reward | Cost | What It Does |
|--------|------|--------------|
| üî• **Speed Up** | ${rewards.speedUp?.baseCost || 500}+ pts | Make it FASTER! |
| üßä **Slow Down** | ${rewards.slowDown?.baseCost || 500}+ pts | Slow it DOWN! |
| üé≤ **CHAOS** | ${rewards.chaos?.baseCost || 2500}+ pts | RANDOM SPEED! |
| ‚ú® **Reset** | ${rewards.reset?.baseCost || 1500}+ pts | Back to normal |

> üí° **Tip:** Prices change dynamically! The more extreme the speed, the more expensive it gets to push further.

## Speed Limits

- **Minimum:** ${game.minPlayrate || 0.5}x (doom mode ü™¶)
- **Maximum:** ${game.maxPlayrate || 4.0}x (ludicrous speed üöÄ)

## Milestones & Achievements

- üî• **2x Speed** - Things are heating up!
- üíÄ **3x Speed** - MAXIMUM OVERDRIVE!
- üöÄ **3.5x+ Speed** - LUDICROUS SPEED!
- üêå **0.5x Speed** - HALF SPEED!
- üßä **0.3x Speed** - FROZEN SOLID!

${requests.enabled ? `
## Song Requests

| Command | Description |
|---------|-------------|
| \`!request <song>\` | Request a song |
| \`!queue\` | Check your position |
| \`!cancel\` | Cancel your request |
` : ''}

---
*Have fun and don't break the streamer too much! ü§ò*
`;

      showDocs(doc);
    }

    function generateFullDocs() {
      const rewards = config.rewards || {};
      const game = config.game || {};
      const requests = config.requests || {};
      const reaper = config.reaper || {};

      const doc = `# üìö HYD Playrate Bot - Full Documentation

## Overview

Interactive Twitch bot that lets viewers control REAPER's playback speed using channel points.

---

## üéõÔ∏è Mod Commands

| Command | Description |
|---------|-------------|
| \`!playrate <0.5-4.0>\` | Set playrate to exact value |
| \`!testreaper\` | Check REAPER OSC connection status |
| \`!reapercommands\` | Show list of available mod commands |

---

## üéÅ Channel Point Rewards

### Base Costs (at 1.0x playrate)

| Reward | Base Cost | Increment | Cooldown |
|--------|-----------|-----------|----------|
| üî• Speed Up | ${rewards.speedUp?.baseCost || 500} pts | +${rewards.speedUp?.increment || 0.1}x | ${rewards.speedUp?.cooldownSeconds || 0}s |
| üßä Slow Down | ${rewards.slowDown?.baseCost || 500} pts | -${rewards.slowDown?.increment || 0.1}x | ${rewards.slowDown?.cooldownSeconds || 0}s |
| üé≤ CHAOS | ${rewards.chaos?.baseCost || 2500} pts | Random | ${rewards.chaos?.cooldownSeconds || 30}s |
| ‚ú® Reset | ${rewards.reset?.baseCost || 1500} pts | ‚Üí 1.0x | ${rewards.reset?.cooldownSeconds || 60}s |

### Dynamic Pricing

**Enabled:** ${rewards.dynamicPricing?.enabled ? 'Yes' : 'No'}

${rewards.dynamicPricing?.enabled ? `
| Setting | Value |
|---------|-------|
| Scale Factor | ${rewards.dynamicPricing?.scaleFactor || 1.5}x |
| Min Cost | ${rewards.dynamicPricing?.minCost || 100} pts |
| Max Cost | ${rewards.dynamicPricing?.maxCost || 50000} pts |
| Reset Mercy Rule | ${rewards.dynamicPricing?.resetDiscountAtExtremes ? 'Yes' : 'No'} |

**How it works:**
- Speed Up: Exponentially more expensive at high speeds
- Slow Down: Exponentially more expensive at low speeds
- Chaos: More expensive at extremes
- Reset: Gets CHEAPER at extremes (escape valve)
` : ''}

---

## ‚öôÔ∏è Game Settings

| Setting | Value |
|---------|-------|
| Min Playrate | ${game.minPlayrate || 0.5}x |
| Max Playrate | ${game.maxPlayrate || 4.0}x |
| Default Playrate | ${game.defaultPlayrate || 1.0}x |
| Global Cooldown | ${game.globalCooldown?.enabled ? game.globalCooldown.seconds + 's' : 'Disabled'} |
| Auto Reset | ${game.autoReset?.enabled ? 'After ' + game.autoReset.delaySeconds + 's ‚Üí ' + game.autoReset.resetTo + 'x' : 'Disabled'} |

### Proportional Scaling

**Enabled:** ${game.proportionalScaling?.enabled ? 'Yes' : 'No'}
**Reference BPM:** ${game.proportionalScaling?.referenceBpm || 120}

Keeps tempo change consistent regardless of song BPM.

---

## üì° REAPER OSC

| Setting | Value |
|---------|-------|
| Host | ${reaper.host || '127.0.0.1'} |
| Send Port | ${reaper.sendPort || 8000} |
| Receive Port | ${reaper.receivePort || 9000} |

---

${requests.enabled ? `
## üéµ Song Requests

**Enabled:** Yes

| Setting | Value |
|---------|-------|
| Command | ${requests.command || '!request'} |
| Aliases | ${(requests.aliases || []).join(', ') || 'None'} |
| Sub Only | ${requests.subOnly ? 'Yes' : 'No'} |
| Follower Only | ${requests.requireFollower ? 'Yes' : 'No'} |
| User Cooldown | ${requests.userCooldownMinutes || 5} min |
| Max Queue Size | ${requests.maxQueueSize || 50} |

### Viewer Commands

| Command | Description |
|---------|-------------|
| \`${requests.command || '!request'} <song>\` | Request a song |
| \`!queue\` / \`!myrequest\` | Check your request status |
| \`!cancel\` | Cancel your request |
` : '## üéµ Song Requests\n\n**Enabled:** No'}

---

## üèÜ Milestones

| Speed | Milestone |
|-------|-----------|
| 2.0x | üî• First time hitting 2x! |
| 3.0x | üíÄ MAXIMUM OVERDRIVE! |
| 3.5x+ | üöÄ LUDICROUS SPEED! |
| 0.5x | üêå HALF SPEED! |
| 0.3x | üßä FROZEN SOLID! |
| 0.25x | ü¶• SLOTH MODE! |

---

## üî• Visual Effects

- Fire effects at high speeds (1.3x+)
- Ice/snowstorm effects at low speeds (0.8x-)
- Combo system for consecutive actions
- Screen shake and particles

---

*Generated by HYD Playrate Bot*
*Config Panel: http://localhost:${config.webPort || 9030}*
`;

      showDocs(doc);
    }

    function showDocs(markdown) {
      document.getElementById('docsOutput').style.display = 'block';
      document.getElementById('docsTextarea').value = markdown;
    }

    function copyDocs() {
      const textarea = document.getElementById('docsTextarea');
      textarea.select();
      document.execCommand('copy');
      showToast('Documentation copied to clipboard!', 'success');
    }

    // Load initial state
    async function init() {
      connectWS();

      const response = await fetch('/api/state');
      const state = await response.json();
      updateState(state);

      const configResponse = await fetch('/api/config');
      config = await configResponse.json();
      updateUI();
    }

    init();
  </script>
</body>
</html>
